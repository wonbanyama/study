# 분산 시스템에서의 유일 ID 생성기 설계

## 1. 문제 이해 및 설계 범위 확정🎯
ID 생성기는 다음과 같은 요구사항을 충족해야 함:
- 유일성 (Unique): 중복되지 않는 ID 생성
- 숫자로만 구성: ID는 숫자로만 이루어져야 함
- 시간순 정렬 가능: 발급된 ID가 발급 날짜 기준으로 정렬될 수 있어야 함
- 64비트 표현 가능: ID는 64비트 이내여야 함
- 초당 10,000개 이상 생성 가능

## 2. ID 생성 방식 선택🛠️

### 1) 다중 마스터 복제 (Multi-Master Replication)
- **방식**: 여러 데이터베이스 서버의 `auto_increment` 속성을 활용하여, 서버마다 시작 값을 다르게 설정하고 ID를 생성
- **장점**:
  - 데이터베이스 서버 수를 늘리면 초당 생성 가능한 ID 수 증가
- **단점**:
  - 데이터 센터 간 확장이 어렵고, ID가 시간순으로 정렬되지 않음
  - 서버 추가/삭제 시 유연하게 대응하기 어려움

### 2) UUID (Universally Unique Identifier)
- **방식**: 128비트 크기의 유니크한 문자열 ID를 생성
- **장점**:
  - 충돌 가능성이 극히 낮고, 서버 간 동기화 필요 없음
  - 분산 시스템에서 확장성이 뛰어남
- **단점**:
  - ID가 128비트로 길어 저장 공간 낭비
  - 숫자가 아닌 값이 포함될 수 있으며, 시간순 정렬 불가

### 3) 티켓 서버 (Ticket Server)
- **방식**: 중앙 집중식 데이터베이스 서버에서 `auto_increment`를 사용하여 ID를 순차적으로 생성
- **장점**:
  - ID가 숫자로만 구성되며, 시간순 정렬 가능
  - 구현이 단순하여 중소 규모 애플리케이션에 적합
- **단점**:
  - 단일 장애 지점(SPOF, Single Point of Failure) 발생 가능
  - 확장성을 높이려면 데이터 동기화 문제 발생

### 4) 트위터 스노우플레이크 (Twitter Snowflake)
- **방식**: 64비트 ID를 여러 개의 필드로 나누어 생성
  - **Sign bit (1비트)**: 부호 비트
  - **Timestamp (41비트)**: 기준 시간(epoch)부터 경과한 밀리초 수
  - **Datacenter ID (5비트)**: 32개 데이터 센터 지원 가능
  - **Server ID (5비트)**: 각 데이터 센터당 32개 서버 지원 가능
  - **Sequence Number (12비트)**: 1밀리초당 최대 4096개의 ID 생성 가능
- **장점**:
  - ID가 숫자로만 구성되며, 시간순 정렬 가능
  - 분산 환경에서 확장 가능하고, 충돌 방지 가능
- **단점**:
  - 시간 동기화 문제가 발생할 수 있음 (NTP 등을 통한 해결 필요)
  - 69년이 지나면 기원 시각(epoch) 변경 필요

## 3. 상세 설계 (Twitter Snowflake 기반)🔍

### 데이터 센터 ID 및 서버 ID
- 시스템 시작 시 결정되며, 운영 중 변경되지 않음
- 중복 방지를 위해 신중한 관리 필요

### 타임스탬프 (Timestamp)
- 41비트 크기로, 기원 시각(epoch) 이후 경과한 밀리초 수 저장
- 69년 후 오버플로 방지를 위해 기원 시각 변경 필요

### 일련 번호 (Sequence Number)
- 12비트 크기로, 1밀리초 동안 최대 4096개의 ID 생성 가능
- 밀리초가 변경되면 초기화됨

## 4. 추가 고려 사항🔥

### 1) 시계 동기화 (Clock Synchronization)
- ID 생성 서버 간 동기화를 위해 NTP(Network Time Protocol) 사용
- 시계 역행(clock drift) 문제가 발생하면 ID 충돌 가능성이 높아지므로 보정 필요

### 2) 각 섹션의 길이 최적화
- 동시성이 낮은 애플리케이션에서는 일련번호 비트를 줄이고 타임스탬프 비트를 늘리는 것도 고려 가능

### 3) 고가용성 (High Availability)
- ID 생성 서버가 단일 장애 지점이 되지 않도록 분산 배치 필요
- 로드 밸런서를 활용하여 부하를 분산하고, 여러 데이터 센터에서 운영 가능하도록 설계

## 5. 결론🏁
- 다중 마스터 복제, UUID, 티켓 서버 방식은 이번 요구사항을 만족하지 못함
- **Twitter Snowflake** 방식이 가장 적합하며, 이를 기반으로 ID 생성기를 설계 가능
- 시계 동기화, 가용성 확보, 각 필드 최적화 등의 추가 고려 사항도 포함하여 설계 마무리

